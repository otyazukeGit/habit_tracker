!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e){t.exports=require("electron")},function(t,e){t.exports=require("path")},function(t,e,n){(function(){var n=this,r=n._,i={},o=Array.prototype,a=Object.prototype,u=Function.prototype,c=o.push,s=o.slice,l=o.concat,f=a.toString,h=a.hasOwnProperty,p=o.forEach,d=o.map,y=o.reduce,g=o.reduceRight,v=o.filter,m=o.every,b=o.some,w=o.indexOf,k=o.lastIndexOf,x=Array.isArray,$=Object.keys,O=u.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};t.exports&&(e=t.exports=E),e._=E,E.VERSION="1.4.4";var A=E.each=E.forEach=function(t,e,n){if(null!=t)if(p&&t.forEach===p)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,o=t.length;r<o;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a in t)if(E.has(t,a)&&e.call(n,t[a],a,t)===i)return};E.map=E.collect=function(t,e,n){var r=[];return null==t?r:d&&t.map===d?t.map(e,n):(A(t,(function(t,i,o){r[r.length]=e.call(n,t,i,o)})),r)};var _="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),y&&t.reduce===y)return r&&(e=E.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(A(t,(function(t,o,a){i?n=e.call(r,n,t,o,a):(n=t,i=!0)})),!i)throw new TypeError(_);return n},E.reduceRight=E.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),g&&t.reduceRight===g)return r&&(e=E.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var o=t.length;if(o!==+o){var a=E.keys(t);o=a.length}if(A(t,(function(u,c,s){c=a?a[--o]:--o,i?n=e.call(r,n,t[c],c,s):(n=t[c],i=!0)})),!i)throw new TypeError(_);return n},E.find=E.detect=function(t,e,n){var r;return D(t,(function(t,i,o){if(e.call(n,t,i,o))return r=t,!0})),r},E.filter=E.select=function(t,e,n){var r=[];return null==t?r:v&&t.filter===v?t.filter(e,n):(A(t,(function(t,i,o){e.call(n,t,i,o)&&(r[r.length]=t)})),r)},E.reject=function(t,e,n){return E.filter(t,(function(t,r,i){return!e.call(n,t,r,i)}),n)},E.every=E.all=function(t,e,n){e||(e=E.identity);var r=!0;return null==t?r:m&&t.every===m?t.every(e,n):(A(t,(function(t,o,a){if(!(r=r&&e.call(n,t,o,a)))return i})),!!r)};var D=E.some=E.any=function(t,e,n){e||(e=E.identity);var r=!1;return null==t?r:b&&t.some===b?t.some(e,n):(A(t,(function(t,o,a){if(r||(r=e.call(n,t,o,a)))return i})),!!r)};E.contains=E.include=function(t,e){return null!=t&&(w&&t.indexOf===w?-1!=t.indexOf(e):D(t,(function(t){return t===e})))},E.invoke=function(t,e){var n=s.call(arguments,2),r=E.isFunction(e);return E.map(t,(function(t){return(r?e:t[e]).apply(t,n)}))},E.pluck=function(t,e){return E.map(t,(function(t){return t[e]}))},E.where=function(t,e,n){return E.isEmpty(e)?n?null:[]:E[n?"find":"filter"](t,(function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0}))},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var r={computed:-1/0,value:-1/0};return A(t,(function(t,i,o){var a=e?e.call(n,t,i,o):t;a>=r.computed&&(r={value:t,computed:a})})),r.value},E.min=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var r={computed:1/0,value:1/0};return A(t,(function(t,i,o){var a=e?e.call(n,t,i,o):t;a<r.computed&&(r={value:t,computed:a})})),r.value},E.shuffle=function(t){var e,n=0,r=[];return A(t,(function(t){e=E.random(n++),r[n-1]=r[e],r[e]=t})),r};var j=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,n){var r=j(e);return E.pluck(E.map(t,(function(t,e,i){return{value:t,index:e,criteria:r.call(n,t,e,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index<e.index?-1:1})),"value")};var S=function(t,e,n,r){var i={},o=j(e||E.identity);return A(t,(function(e,a){var u=o.call(n,e,a,t);r(i,u,e)})),i};E.groupBy=function(t,e,n){return S(t,e,n,(function(t,e,n){(E.has(t,e)?t[e]:t[e]=[]).push(n)}))},E.countBy=function(t,e,n){return S(t,e,n,(function(t,e){E.has(t,e)||(t[e]=0),t[e]++}))},E.sortedIndex=function(t,e,n,r){for(var i=(n=null==n?E.identity:j(n)).call(r,e),o=0,a=t.length;o<a;){var u=o+a>>>1;n.call(r,t[u])<i?o=u+1:a=u}return o},E.toArray=function(t){return t?E.isArray(t)?s.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:s.call(t,0,e)},E.initial=function(t,e,n){return s.call(t,0,t.length-(null==e||n?1:e))},E.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:s.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,n){return s.call(t,null==e||n?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var M=function(t,e,n){return A(t,(function(t){E.isArray(t)?e?c.apply(n,t):M(t,e,n):n.push(t)})),n};E.flatten=function(t,e){return M(t,e,[])},E.without=function(t){return E.difference(t,s.call(arguments,1))},E.uniq=E.unique=function(t,e,n,r){E.isFunction(e)&&(r=n,n=e,e=!1);var i=n?E.map(t,n,r):t,o=[],a=[];return A(i,(function(n,r){(e?r&&a[a.length-1]===n:E.contains(a,n))||(a.push(n),o.push(t[r]))})),o},E.union=function(){return E.uniq(l.apply(o,arguments))},E.intersection=function(t){var e=s.call(arguments,1);return E.filter(E.uniq(t),(function(t){return E.every(e,(function(e){return E.indexOf(e,t)>=0}))}))},E.difference=function(t){var e=l.apply(o,s.call(arguments,1));return E.filter(t,(function(t){return!E.contains(e,t)}))},E.zip=function(){for(var t=s.call(arguments),e=E.max(E.pluck(t,"length")),n=new Array(e),r=0;r<e;r++)n[r]=E.pluck(t,""+r);return n},E.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},E.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return t[r=E.sortedIndex(t,e)]===e?r:-1;r=n<0?Math.max(0,i+n):n}if(w&&t.indexOf===w)return t.indexOf(e,n);for(;r<i;r++)if(t[r]===e)return r;return-1},E.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=null!=n;if(k&&t.lastIndexOf===k)return r?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var i=r?n:t.length;i--;)if(t[i]===e)return i;return-1},E.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,o=new Array(r);i<r;)o[i++]=t,t+=n;return o},E.bind=function(t,e){if(t.bind===O&&O)return O.apply(t,s.call(arguments,1));var n=s.call(arguments,2);return function(){return t.apply(e,n.concat(s.call(arguments)))}},E.partial=function(t){var e=s.call(arguments,1);return function(){return t.apply(this,e.concat(s.call(arguments)))}},E.bindAll=function(t){var e=s.call(arguments,1);return 0===e.length&&(e=E.functions(t)),A(e,(function(e){t[e]=E.bind(t[e],t)})),t},E.memoize=function(t,e){var n={};return e||(e=E.identity),function(){var r=e.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},E.delay=function(t,e){var n=s.call(arguments,2);return setTimeout((function(){return t.apply(null,n)}),e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(s.call(arguments,1)))},E.throttle=function(t,e){var n,r,i,o,a=0,u=function(){a=new Date,i=null,o=t.apply(n,r)};return function(){var c=new Date,s=e-(c-a);return n=this,r=arguments,s<=0?(clearTimeout(i),i=null,a=c,o=t.apply(n,r)):i||(i=setTimeout(u,s)),o}},E.debounce=function(t,e,n){var r,i;return function(){var o=this,a=arguments,u=function(){r=null,n||(i=t.apply(o,a))},c=n&&!r;return clearTimeout(r),r=setTimeout(u,e),c&&(i=t.apply(o,a)),i}},E.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},E.wrap=function(t,e){return function(){var n=[t];return c.apply(n,arguments),e.apply(this,n)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},E.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},E.keys=$||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)E.has(t,n)&&(e[e.length]=n);return e},E.values=function(t){var e=[];for(var n in t)E.has(t,n)&&e.push(t[n]);return e},E.pairs=function(t){var e=[];for(var n in t)E.has(t,n)&&e.push([n,t[n]]);return e},E.invert=function(t){var e={};for(var n in t)E.has(t,n)&&(e[t[n]]=n);return e},E.functions=E.methods=function(t){var e=[];for(var n in t)E.isFunction(t[n])&&e.push(n);return e.sort()},E.extend=function(t){return A(s.call(arguments,1),(function(e){if(e)for(var n in e)t[n]=e[n]})),t},E.pick=function(t){var e={},n=l.apply(o,s.call(arguments,1));return A(n,(function(n){n in t&&(e[n]=t[n])})),e},E.omit=function(t){var e={},n=l.apply(o,s.call(arguments,1));for(var r in t)E.contains(n,r)||(e[r]=t[r]);return e},E.defaults=function(t){return A(s.call(arguments,1),(function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])})),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var T=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var i=f.call(t);if(i!=f.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]==t)return r[o]==e;n.push(t),r.push(e);var a=0,u=!0;if("[object Array]"==i){if(u=(a=t.length)==e.length)for(;a--&&(u=T(t[a],e[a],n,r)););}else{var c=t.constructor,s=e.constructor;if(c!==s&&!(E.isFunction(c)&&c instanceof c&&E.isFunction(s)&&s instanceof s))return!1;for(var l in t)if(E.has(t,l)&&(a++,!(u=E.has(e,l)&&T(t[l],e[l],n,r))))break;if(u){for(l in e)if(E.has(e,l)&&!a--)break;u=!a}}return n.pop(),r.pop(),u};E.isEqual=function(t,e){return T(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=x||function(t){return"[object Array]"==f.call(t)},E.isObject=function(t){return t===Object(t)},A(["Arguments","Function","String","Number","Date","RegExp"],(function(t){E["is"+t]=function(e){return f.call(e)=="[object "+t+"]"}})),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),E.isFunction=function(t){return"function"==typeof t},E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==f.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return h.call(t,e)},E.noConflict=function(){return n._=r,this},E.identity=function(t){return t},E.times=function(t,e,n){for(var r=Array(t),i=0;i<t;i++)r[i]=e.call(n,i);return r},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};N.unescape=E.invert(N.escape);var I={escape:new RegExp("["+E.keys(N.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(N.unescape).join("|")+")","g")};E.each(["escape","unescape"],(function(t){E[t]=function(e){return null==e?"":(""+e).replace(I[t],(function(e){return N[t][e]}))}})),E.result=function(t,e){if(null==t)return null;var n=t[e];return E.isFunction(n)?n.call(t):n},E.mixin=function(t){A(E.functions(t),(function(e){var n=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),q.call(this,n.apply(E,t))}}))};var C=0;E.uniqueId=function(t){var e=++C+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,n){var r;n=E.defaults({},n,E.templateSettings);var i=new RegExp([(n.escape||F).source,(n.interpolate||F).source,(n.evaluate||F).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(i,(function(e,n,r,i,u){return a+=t.slice(o,u).replace(K,(function(t){return"\\"+P[t]})),n&&(a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=u+e.length,e})),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(n.variable||"obj","_",a)}catch(t){throw t.source=a,t}if(e)return r(e,E);var u=function(t){return r.call(this,t,E)};return u.source="function("+(n.variable||"obj")+"){\n"+a+"}",u},E.chain=function(t){return E(t).chain()};var q=function(t){return this._chain?E(t).chain():t};E.mixin(E),A(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=o[t];E.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],q.call(this,n)}})),A(["concat","join","slice"],(function(t){var e=o[t];E.prototype[t]=function(){return q.call(this,e.apply(this._wrapped,arguments))}})),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(t,e){t.exports=require("fs")},function(t,e,n){var r=n(5),i=n(2),o={},a={},u={},c={},s={};function l(t,e){if("number"==typeof t&&(t=t.toString()),!("$"!==t[0]||"$$date"===t&&"number"==typeof e||"$$deleted"===t&&!0===e||"$$indexCreated"===t||"$$indexRemoved"===t))throw new Error("Field names cannot begin with the $ character");if(-1!==t.indexOf("."))throw new Error("Field names cannot contain a .")}function f(t){r.isArray(t)&&t.forEach((function(t){f(t)})),"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){l(e,t[e]),f(t[e])}))}function h(t,e){var n;return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null===t||r.isDate(t)?t:r.isArray(t)?(n=[],t.forEach((function(t){n.push(h(t,e))})),n):"object"==typeof t?(n={},Object.keys(t).forEach((function(r){(!e||"$"!==r[0]&&-1===r.indexOf("."))&&(n[r]=h(t[r],e))})),n):void 0}function p(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null===t||r.isDate(t)||r.isArray(t)}function d(t,e){return t<e?-1:t>e?1:0}function y(t,e){var n,r;for(n=0;n<Math.min(t.length,e.length);n+=1)if(0!==(r=g(t[n],e[n])))return r;return d(t.length,e.length)}function g(t,e,n){var i,o,a,u,c=n||d;if(void 0===t)return void 0===e?0:-1;if(void 0===e)return void 0===t?0:1;if(null===t)return null===e?0:-1;if(null===e)return null===t?0:1;if("number"==typeof t)return"number"==typeof e?d(t,e):-1;if("number"==typeof e)return"number"==typeof t?d(t,e):1;if("string"==typeof t)return"string"==typeof e?c(t,e):-1;if("string"==typeof e)return"string"==typeof t?c(t,e):1;if("boolean"==typeof t)return"boolean"==typeof e?d(t,e):-1;if("boolean"==typeof e)return"boolean"==typeof t?d(t,e):1;if(r.isDate(t))return r.isDate(e)?d(t.getTime(),e.getTime()):-1;if(r.isDate(e))return r.isDate(t)?d(t.getTime(),e.getTime()):1;if(r.isArray(t))return r.isArray(e)?y(t,e):-1;if(r.isArray(e))return r.isArray(t)?y(t,e):1;for(i=Object.keys(t).sort(),o=Object.keys(e).sort(),u=0;u<Math.min(i.length,o.length);u+=1)if(0!==(a=g(t[i[u]],e[o[u]])))return a;return d(i.length,o.length)}function v(t,e){var n,i,o="string"==typeof e?e.split("."):e;if(t){if(0===o.length)return t;if(1===o.length)return t[o[0]];if(r.isArray(t[o[0]])){if("number"==typeof(n=parseInt(o[1],10))&&!isNaN(n))return v(t[o[0]][n],o.slice(2));for(i=new Array,n=0;n<t[o[0]].length;n+=1)i.push(v(t[o[0]][n],o.slice(1)));return i}return v(t[o[0]],o.slice(1))}}function m(t,e){var n,i,o;if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e)return t===e;if(r.isDate(t)||r.isDate(e))return r.isDate(t)&&r.isDate(e)&&t.getTime()===e.getTime();if((!r.isArray(t)||!r.isArray(e))&&(r.isArray(t)||r.isArray(e))||void 0===t||void 0===e)return!1;try{n=Object.keys(t),i=Object.keys(e)}catch(t){return!1}if(n.length!==i.length)return!1;for(o=0;o<n.length;o+=1){if(-1===i.indexOf(n[o]))return!1;if(!m(t[n[o]],e[n[o]]))return!1}return!0}function b(t,e){return!("string"!=typeof t&&"number"!=typeof t&&!r.isDate(t)&&"string"!=typeof e&&"number"!=typeof e&&!r.isDate(e))&&typeof t==typeof e}function w(t,e){var n,r,i,o;if(p(t)||p(e))return k({needAKey:t},"needAKey",e);for(n=Object.keys(e),o=0;o<n.length;o+=1)if(i=e[r=n[o]],"$"===r[0]){if(!c[r])throw new Error("Unknown logical operator "+r);if(!c[r](t,i))return!1}else if(!k(t,r,i))return!1;return!0}function k(t,e,n,o){var a,c,l,f,h=v(t,e);if(r.isArray(h)&&!o){if(r.isArray(n))return k(t,e,n,!0);if(null!==n&&"object"==typeof n&&!r.isRegExp(n))for(c=Object.keys(n),a=0;a<c.length;a+=1)if(s[c[a]])return k(t,e,n,!0);for(a=0;a<h.length;a+=1)if(k({k:h[a]},"k",n))return!0;return!1}if(null!==n&&"object"==typeof n&&!r.isRegExp(n)&&!r.isArray(n)){if(c=Object.keys(n),l=i.map(c,(function(t){return t[0]})),0!==(f=i.filter(l,(function(t){return"$"===t}))).length&&f.length!==l.length)throw new Error("You cannot mix operators and normal fields");if(f.length>0){for(a=0;a<c.length;a+=1){if(!u[c[a]])throw new Error("Unknown comparison function "+c[a]);if(!u[c[a]](h,n[c[a]]))return!1}return!0}}return r.isRegExp(n)?u.$regex(h,n):!!m(h,n)}a.$set=function(t,e,n){t[e]=n},a.$unset=function(t,e,n){delete t[e]},a.$push=function(t,e,n){if(t.hasOwnProperty(e)||(t[e]=[]),!r.isArray(t[e]))throw new Error("Can't $push an element on non-array values");if(null!==n&&"object"==typeof n&&n.$slice&&void 0===n.$each&&(n.$each=[]),null!==n&&"object"==typeof n&&n.$each){if(Object.keys(n).length>=3||2===Object.keys(n).length&&void 0===n.$slice)throw new Error("Can only use $slice in cunjunction with $each when $push to array");if(!r.isArray(n.$each))throw new Error("$each requires an array value");if(n.$each.forEach((function(n){t[e].push(n)})),void 0===n.$slice||"number"!=typeof n.$slice)return;if(0===n.$slice)t[e]=[];else{var i,o,a=t[e].length;n.$slice<0?(i=Math.max(0,a+n.$slice),o=a):n.$slice>0&&(i=0,o=Math.min(a,n.$slice)),t[e]=t[e].slice(i,o)}}else t[e].push(n)},a.$addToSet=function(t,e,n){var i=!0;if(t.hasOwnProperty(e)||(t[e]=[]),!r.isArray(t[e]))throw new Error("Can't $addToSet an element on non-array values");if(null!==n&&"object"==typeof n&&n.$each){if(Object.keys(n).length>1)throw new Error("Can't use another field in conjunction with $each");if(!r.isArray(n.$each))throw new Error("$each requires an array value");n.$each.forEach((function(n){a.$addToSet(t,e,n)}))}else t[e].forEach((function(t){0===g(t,n)&&(i=!1)})),i&&t[e].push(n)},a.$pop=function(t,e,n){if(!r.isArray(t[e]))throw new Error("Can't $pop an element from non-array values");if("number"!=typeof n)throw new Error(n+" isn't an integer, can't use it with $pop");0!==n&&(t[e]=n>0?t[e].slice(0,t[e].length-1):t[e].slice(1))},a.$pull=function(t,e,n){var i,o;if(!r.isArray(t[e]))throw new Error("Can't $pull an element from non-array values");for(o=(i=t[e]).length-1;o>=0;o-=1)w(i[o],n)&&i.splice(o,1)},a.$inc=function(t,e,n){if("number"!=typeof n)throw new Error(n+" must be a number");if("number"!=typeof t[e]){if(i.has(t,e))throw new Error("Don't use the $inc modifier on non-number fields");t[e]=n}else t[e]+=n},a.$max=function(t,e,n){(void 0===t[e]||n>t[e])&&(t[e]=n)},a.$min=function(t,e,n){(void 0===t[e]||n<t[e])&&(t[e]=n)},Object.keys(a).forEach((function(t){o[t]=function(t){return function(e,n,r){var i="string"==typeof n?n.split("."):n;if(1===i.length)a[t](e,n,r);else{if(void 0===e[i[0]]){if("$unset"===t)return;e[i[0]]={}}o[t](e[i[0]],i.slice(1),r)}}}(t)})),u.$lt=function(t,e){return b(t,e)&&t<e},u.$lte=function(t,e){return b(t,e)&&t<=e},u.$gt=function(t,e){return b(t,e)&&t>e},u.$gte=function(t,e){return b(t,e)&&t>=e},u.$ne=function(t,e){return void 0===t||!m(t,e)},u.$in=function(t,e){var n;if(!r.isArray(e))throw new Error("$in operator called with a non-array");for(n=0;n<e.length;n+=1)if(m(t,e[n]))return!0;return!1},u.$nin=function(t,e){if(!r.isArray(e))throw new Error("$nin operator called with a non-array");return!u.$in(t,e)},u.$regex=function(t,e){if(!r.isRegExp(e))throw new Error("$regex operator called with non regular expression");return"string"==typeof t&&e.test(t)},u.$exists=function(t,e){return e=!(!e&&""!==e),void 0===t?!e:e},u.$size=function(t,e){if(!r.isArray(t))return!1;if(e%1!=0)throw new Error("$size operator called without an integer");return t.length==e},u.$elemMatch=function(t,e){if(!r.isArray(t))return!1;for(var n=t.length,i=!1;n--;)if(w(t[n],e)){i=!0;break}return i},s.$size=!0,s.$elemMatch=!0,c.$or=function(t,e){var n;if(!r.isArray(e))throw new Error("$or operator used without an array");for(n=0;n<e.length;n+=1)if(w(t,e[n]))return!0;return!1},c.$and=function(t,e){var n;if(!r.isArray(e))throw new Error("$and operator used without an array");for(n=0;n<e.length;n+=1)if(!w(t,e[n]))return!1;return!0},c.$not=function(t,e){return!w(t,e)},c.$where=function(t,e){var n;if(!i.isFunction(e))throw new Error("$where operator used without a function");if(n=e.call(t),!i.isBoolean(n))throw new Error("$where function must return boolean");return n},t.exports.serialize=function(t){return JSON.stringify(t,(function(t,e){if(l(t,e),void 0!==e)return null===e?null:"function"==typeof this[t].getTime?{$$date:this[t].getTime()}:e}))},t.exports.deserialize=function(t){return JSON.parse(t,(function(t,e){return"$$date"===t?new Date(e):"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e?e:e&&e.$$date?e.$$date:e}))},t.exports.deepCopy=h,t.exports.checkObject=f,t.exports.isPrimitiveType=p,t.exports.modify=function(t,e){var n,r,a=Object.keys(e),u=i.map(a,(function(t){return t[0]})),c=i.filter(u,(function(t){return"$"===t}));if(-1!==a.indexOf("_id")&&e._id!==t._id)throw new Error("You cannot change a document's _id");if(0!==c.length&&c.length!==u.length)throw new Error("You cannot mix modifiers and normal fields");if(0===c.length?(n=h(e))._id=t._id:(r=i.uniq(a),n=h(t),r.forEach((function(t){if(!o[t])throw new Error("Unknown modifier "+t);if("object"!=typeof e[t])throw new Error("Modifier "+t+"'s argument must be an object");Object.keys(e[t]).forEach((function(r){o[t](n,r,e[t][r])}))}))),f(n),t._id!==n._id)throw new Error("You can't change a document's _id");return n},t.exports.getDotValue=v,t.exports.match=w,t.exports.areThingsEqual=m,t.exports.compareThings=g},function(t,e){t.exports=require("util")},function(t,e,n){var r;!function(){var n,i,o={};function a(t){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,t.apply(n,arguments)}}null!=(n=this)&&(i=n.async),o.noConflict=function(){return n.async=i,o};var u=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n+=1)e(t[n],n,t)},c=function(t,e){if(t.map)return t.map(e);var n=[];return u(t,(function(t,r,i){n.push(e(t,r,i))})),n},s=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(o.nextTick=process.nextTick,"undefined"!=typeof setImmediate?o.setImmediate=function(t){setImmediate(t)}:o.setImmediate=o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(t){setImmediate(t)},o.setImmediate=o.nextTick):(o.nextTick=function(t){setTimeout(t,0)},o.setImmediate=o.nextTick),o.each=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0;u(t,(function(i){e(i,a((function(e){e?(n(e),n=function(){}):(r+=1)>=t.length&&n(null)})))}))},o.forEach=o.each,o.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,i=function(){e(t[r],(function(e){e?(n(e),n=function(){}):(r+=1)>=t.length?n(null):i()}))};i()},o.forEachSeries=o.eachSeries,o.eachLimit=function(t,e,n,r){l(e).apply(null,[t,n,r])},o.forEachLimit=o.eachLimit;var l=function(t){return function(e,n,r){if(r=r||function(){},!e.length||t<=0)return r();var i=0,o=0,a=0;!function u(){if(i>=e.length)return r();for(;a<t&&o<e.length;)a+=1,n(e[(o+=1)-1],(function(t){t?(r(t),r=function(){}):(a-=1,(i+=1)>=e.length?r():u())}))}()}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[o.each].concat(e))}},h=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[o.eachSeries].concat(e))}},p=function(t,e,n,r){var i=[];t(e=c(e,(function(t,e){return{index:e,value:t}})),(function(t,e){n(t.value,(function(n,r){i[t.index]=r,e(n)}))}),(function(t){r(t,i)}))};o.map=f(p),o.mapSeries=h(p),o.mapLimit=function(t,e,n,r){return d(e)(t,n,r)};var d=function(t){return function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[l(t)].concat(n))}}(t,p)};o.reduce=function(t,e,n,r){o.eachSeries(t,(function(t,r){n(e,t,(function(t,n){e=n,r(t)}))}),(function(t){r(t,e)}))},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(t,e,n,r){var i=c(t,(function(t){return t})).reverse();o.reduce(i,e,n,r)},o.foldr=o.reduceRight;var y=function(t,e,n,r){var i=[];t(e=c(e,(function(t,e){return{index:e,value:t}})),(function(t,e){n(t.value,(function(n){n&&i.push(t),e()}))}),(function(t){r(c(i.sort((function(t,e){return t.index-e.index})),(function(t){return t.value})))}))};o.filter=f(y),o.filterSeries=h(y),o.select=o.filter,o.selectSeries=o.filterSeries;var g=function(t,e,n,r){var i=[];t(e=c(e,(function(t,e){return{index:e,value:t}})),(function(t,e){n(t.value,(function(n){n||i.push(t),e()}))}),(function(t){r(c(i.sort((function(t,e){return t.index-e.index})),(function(t){return t.value})))}))};o.reject=f(g),o.rejectSeries=h(g);var v=function(t,e,n,r){t(e,(function(t,e){n(t,(function(n){n?(r(t),r=function(){}):e()}))}),(function(t){r()}))};o.detect=f(v),o.detectSeries=h(v),o.some=function(t,e,n){o.each(t,(function(t,r){e(t,(function(t){t&&(n(!0),n=function(){}),r()}))}),(function(t){n(!1)}))},o.any=o.some,o.every=function(t,e,n){o.each(t,(function(t,r){e(t,(function(t){t||(n(!1),n=function(){}),r()}))}),(function(t){n(!0)}))},o.all=o.every,o.sortBy=function(t,e,n){o.map(t,(function(t,n){e(t,(function(e,r){e?n(e):n(null,{value:t,criteria:r})}))}),(function(t,e){if(t)return n(t);n(null,c(e.sort((function(t,e){var n=t.criteria,r=e.criteria;return n<r?-1:n>r?1:0})),(function(t){return t.value})))}))},o.auto=function(t,e){e=e||function(){};var n=s(t);if(!n.length)return e(null);var r={},i=[],a=function(t){i.unshift(t)},c=function(){u(i.slice(0),(function(t){t()}))};a((function(){s(r).length===n.length&&(e(null,r),e=function(){})})),u(n,(function(n){var l=t[n]instanceof Function?[t[n]]:t[n],f=function(t){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),t){var a={};u(s(r),(function(t){a[t]=r[t]})),a[n]=i,e(t,a),e=function(){}}else r[n]=i,o.setImmediate(c)},h=l.slice(0,Math.abs(l.length-1))||[],p=function(){return e=function(t,e){return t&&r.hasOwnProperty(e)},i=!0,((t=h).reduce?t.reduce(e,i):(u(t,(function(t,n,r){i=e(i,t,n,r)})),i))&&!r.hasOwnProperty(n);var t,e,i};if(p())l[l.length-1](f,r);else{var d=function(){p()&&(!function(t){for(var e=0;e<i.length;e+=1)if(i[e]===t)return void i.splice(e,1)}(d),l[l.length-1](f,r))};a(d)}}))},o.waterfall=function(t,e){if(e=e||function(){},t.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var r=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var i=Array.prototype.slice.call(arguments,1),a=t.next();a?i.push(r(a)):i.push(e),o.setImmediate((function(){t.apply(null,i)}))}}};r(o.iterator(t))()};var m=function(t,e,n){if(n=n||function(){},e.constructor===Array)t.map(e,(function(t,e){t&&t((function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)}))}),n);else{var r={};t.each(s(e),(function(t,n){e[t]((function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[t]=i,n(e)}))}),(function(t){n(t,r)}))}};o.parallel=function(t,e){m({map:o.map,each:o.each},t,e)},o.parallelLimit=function(t,e,n){m({map:d(e),each:l(e)},t,n)},o.series=function(t,e){if(e=e||function(){},t.constructor===Array)o.mapSeries(t,(function(t,e){t&&t((function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)}))}),e);else{var n={};o.eachSeries(s(t),(function(e,r){t[e]((function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[e]=i,r(t)}))}),(function(t){e(t,n)}))}},o.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},o.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var b=function(t,e,n,r){var i=[];t(e,(function(t,e){n(t,(function(t,n){i=i.concat(n||[]),e(t)}))}),(function(t){r(t,i)}))};o.concat=f(b),o.concatSeries=h(b),o.whilst=function(t,e,n){t()?e((function(r){if(r)return n(r);o.whilst(t,e,n)})):n()},o.doWhilst=function(t,e,n){t((function(r){if(r)return n(r);e()?o.doWhilst(t,e,n):n()}))},o.until=function(t,e,n){t()?n():e((function(r){if(r)return n(r);o.until(t,e,n)}))},o.doUntil=function(t,e,n){t((function(r){if(r)return n(r);e()?n():o.doUntil(t,e,n)}))},o.queue=function(t,e){function n(t,n,r,i){n.constructor!==Array&&(n=[n]),u(n,(function(n){var a={data:n,callback:"function"==typeof i?i:null};r?t.tasks.unshift(a):t.tasks.push(a),t.saturated&&t.tasks.length===e&&t.saturated(),o.setImmediate(t.process)}))}void 0===e&&(e=1);var r=0,i={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,push:function(t,e){n(i,t,!1,e)},unshift:function(t,e){n(i,t,!0,e)},process:function(){if(r<i.concurrency&&i.tasks.length){var e=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=a((function(){r-=1,e.callback&&e.callback.apply(e,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()}));t(e.data,n)}},length:function(){return i.tasks.length},running:function(){return r}};return i},o.cargo=function(t,e){var n=!1,r=[],i={tasks:r,payload:e,saturated:null,empty:null,drain:null,push:function(t,n){t.constructor!==Array&&(t=[t]),u(t,(function(t){r.push({data:t,callback:"function"==typeof n?n:null}),i.saturated&&r.length===e&&i.saturated()})),o.setImmediate(i.process)},process:function o(){if(!n)if(0!==r.length){var a="number"==typeof e?r.splice(0,e):r.splice(0),s=c(a,(function(t){return t.data}));i.empty&&i.empty(),n=!0,t(s,(function(){n=!1;var t=arguments;u(a,(function(e){e.callback&&e.callback.apply(null,t)})),o()}))}else i.drain&&i.drain()},length:function(){return r.length},running:function(){return n}};return i};var w=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&u(n,(function(e){console[t](e)})))}]))}};o.log=w("log"),o.dir=w("dir"),o.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=e.apply(null,i);a in n?o.apply(null,n[a]):a in r?r[a].push(o):(r[a]=[o],t.apply(null,i.concat([function(){n[a]=arguments;var t=r[a];delete r[a];for(var e=0,i=t.length;e<i;e++)t[e].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=t,i},o.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},o.times=function(t,e,n){for(var r=[],i=0;i<t;i++)r.push(i);return o.map(r,e,n)},o.timesSeries=function(t,e,n){for(var r=[],i=0;i<t;i++)r.push(i);return o.mapSeries(r,e,n)},o.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var e=this,n=Array.prototype.slice.call(arguments),r=n.pop();o.reduce(t,n,(function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))}),(function(t,n){r.apply(e,[t].concat(n))}))}};var k=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return t(e,(function(t,e){t.apply(n,r.concat([e]))}),i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};o.applyEach=f(k),o.applyEachSeries=h(k),o.forever=function(t,e){!function n(r){if(r){if(e)return e(r);throw r}t(n)}()},void 0===(r=function(){return o}.apply(e,[]))||(t.exports=r)}()},function(t,e,n){var r=n(14);t.exports.uid=function(t){return r.randomBytes(Math.ceil(Math.max(8,2*t))).toString("base64").replace(/[+\/]/g,"").slice(0,t)}},function(t,e,n){var r=n(16).AVLTree,i=n(4),o=n(2),a=n(5);function u(t,e){return t===e}function c(t){return null===t?"$null":"string"==typeof t?"$string"+t:"boolean"==typeof t?"$boolean"+t:"number"==typeof t?"$number"+t:a.isArray(t)?"$date"+t.getTime():t}function s(t){this.fieldName=t.fieldName,this.unique=t.unique||!1,this.sparse=t.sparse||!1,this.treeOptions={unique:this.unique,compareKeys:i.compareThings,checkValueEquality:u},this.reset()}s.prototype.reset=function(t){this.tree=new r(this.treeOptions),t&&this.insert(t)},s.prototype.insert=function(t){var e,n,r,u,s;if(a.isArray(t))this.insertMultipleDocs(t);else if(void 0!==(e=i.getDotValue(t,this.fieldName))||!this.sparse)if(a.isArray(e)){for(n=o.uniq(e,c),r=0;r<n.length;r+=1)try{this.tree.insert(n[r],t)}catch(t){s=t,u=r;break}if(s){for(r=0;r<u;r+=1)this.tree.delete(n[r],t);throw s}}else this.tree.insert(e,t)},s.prototype.insertMultipleDocs=function(t){var e,n,r;for(e=0;e<t.length;e+=1)try{this.insert(t[e])}catch(t){n=t,r=e;break}if(n){for(e=0;e<r;e+=1)this.remove(t[e]);throw n}},s.prototype.remove=function(t){var e,n=this;a.isArray(t)?t.forEach((function(t){n.remove(t)})):void 0===(e=i.getDotValue(t,this.fieldName))&&this.sparse||(a.isArray(e)?o.uniq(e,c).forEach((function(e){n.tree.delete(e,t)})):this.tree.delete(e,t))},s.prototype.update=function(t,e){if(a.isArray(t))this.updateMultipleDocs(t);else{this.remove(t);try{this.insert(e)}catch(e){throw this.insert(t),e}}},s.prototype.updateMultipleDocs=function(t){var e,n,r;for(e=0;e<t.length;e+=1)this.remove(t[e].oldDoc);for(e=0;e<t.length;e+=1)try{this.insert(t[e].newDoc)}catch(t){r=t,n=e;break}if(r){for(e=0;e<n;e+=1)this.remove(t[e].newDoc);for(e=0;e<t.length;e+=1)this.insert(t[e].oldDoc);throw r}},s.prototype.revertUpdate=function(t,e){var n=[];a.isArray(t)?(t.forEach((function(t){n.push({oldDoc:t.newDoc,newDoc:t.oldDoc})})),this.update(n)):this.update(e,t)},s.prototype.getMatching=function(t){var e=this;if(a.isArray(t)){var n={},r=[];return t.forEach((function(t){e.getMatching(t).forEach((function(t){n[t._id]=t}))})),Object.keys(n).forEach((function(t){r.push(n[t])})),r}return e.tree.search(t)},s.prototype.getBetweenBounds=function(t){return this.tree.betweenBounds(t)},s.prototype.getAll=function(){var t=[];return this.tree.executeOnEveryNode((function(e){var n;for(n=0;n<e.data.length;n+=1)t.push(e.data[n])})),t},t.exports=s},function(t,e,n){var r=n(10);function i(t){t=t||{},this.left=null,this.right=null,this.parent=void 0!==t.parent?t.parent:null,t.hasOwnProperty("key")&&(this.key=t.key),this.data=t.hasOwnProperty("value")?[t.value]:[],this.unique=t.unique||!1,this.compareKeys=t.compareKeys||r.defaultCompareKeysFunction,this.checkValueEquality=t.checkValueEquality||r.defaultCheckValueEquality}function o(t,e){var n;for(n=0;n<e.length;n+=1)t.push(e[n])}i.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this},i.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key},i.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this},i.prototype.getMinKey=function(){return this.getMinKeyDescendant().key},i.prototype.checkAllNodesFullfillCondition=function(t){this.hasOwnProperty("key")&&(t(this.key,this.data),this.left&&this.left.checkAllNodesFullfillCondition(t),this.right&&this.right.checkAllNodesFullfillCondition(t))},i.prototype.checkNodeOrdering=function(){var t=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition((function(e){if(t.compareKeys(e,t.key)>=0)throw new Error("Tree with root "+t.key+" is not a binary search tree")})),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition((function(e){if(t.compareKeys(e,t.key)<=0)throw new Error("Tree with root "+t.key+" is not a binary search tree")})),this.right.checkNodeOrdering()))},i.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw new Error("Parent pointer broken for key "+this.key);this.right.checkInternalPointers()}},i.prototype.checkIsBST=function(){if(this.checkNodeOrdering(),this.checkInternalPointers(),this.parent)throw new Error("The root shouldn't have a parent")},i.prototype.getNumberOfKeys=function(){var t;return this.hasOwnProperty("key")?(t=1,this.left&&(t+=this.left.getNumberOfKeys()),this.right&&(t+=this.right.getNumberOfKeys()),t):0},i.prototype.createSimilar=function(t){return(t=t||{}).unique=this.unique,t.compareKeys=this.compareKeys,t.checkValueEquality=this.checkValueEquality,new this.constructor(t)},i.prototype.createLeftChild=function(t){var e=this.createSimilar(t);return e.parent=this,this.left=e,e},i.prototype.createRightChild=function(t){var e=this.createSimilar(t);return e.parent=this,this.right=e,e},i.prototype.insert=function(t,e){if(!this.hasOwnProperty("key"))return this.key=t,void this.data.push(e);if(0!==this.compareKeys(this.key,t))this.compareKeys(t,this.key)<0?this.left?this.left.insert(t,e):this.createLeftChild({key:t,value:e}):this.right?this.right.insert(t,e):this.createRightChild({key:t,value:e});else{if(this.unique){var n=new Error("Can't insert key "+t+", it violates the unique constraint");throw n.key=t,n.errorType="uniqueViolated",n}this.data.push(e)}},i.prototype.search=function(t){return this.hasOwnProperty("key")?0===this.compareKeys(this.key,t)?this.data:this.compareKeys(t,this.key)<0?this.left?this.left.search(t):[]:this.right?this.right.search(t):[]:[]},i.prototype.getLowerBoundMatcher=function(t){var e=this;return t.hasOwnProperty("$gt")||t.hasOwnProperty("$gte")?t.hasOwnProperty("$gt")&&t.hasOwnProperty("$gte")?0===e.compareKeys(t.$gte,t.$gt)?function(n){return e.compareKeys(n,t.$gt)>0}:e.compareKeys(t.$gte,t.$gt)>0?function(n){return e.compareKeys(n,t.$gte)>=0}:function(n){return e.compareKeys(n,t.$gt)>0}:t.hasOwnProperty("$gt")?function(n){return e.compareKeys(n,t.$gt)>0}:function(n){return e.compareKeys(n,t.$gte)>=0}:function(){return!0}},i.prototype.getUpperBoundMatcher=function(t){var e=this;return t.hasOwnProperty("$lt")||t.hasOwnProperty("$lte")?t.hasOwnProperty("$lt")&&t.hasOwnProperty("$lte")?0===e.compareKeys(t.$lte,t.$lt)?function(n){return e.compareKeys(n,t.$lt)<0}:e.compareKeys(t.$lte,t.$lt)<0?function(n){return e.compareKeys(n,t.$lte)<=0}:function(n){return e.compareKeys(n,t.$lt)<0}:t.hasOwnProperty("$lt")?function(n){return e.compareKeys(n,t.$lt)<0}:function(n){return e.compareKeys(n,t.$lte)<=0}:function(){return!0}},i.prototype.betweenBounds=function(t,e,n){var r=[];return this.hasOwnProperty("key")?(e=e||this.getLowerBoundMatcher(t),n=n||this.getUpperBoundMatcher(t),e(this.key)&&this.left&&o(r,this.left.betweenBounds(t,e,n)),e(this.key)&&n(this.key)&&o(r,this.data),n(this.key)&&this.right&&o(r,this.right.betweenBounds(t,e,n)),r):[]},i.prototype.deleteIfLeaf=function(){return!this.left&&!this.right&&(this.parent?(this.parent.left===this?this.parent.left=null:this.parent.right=null,!0):(delete this.key,this.data=[],!0))},i.prototype.deleteIfOnlyOneChild=function(){var t;return this.left&&!this.right&&(t=this.left),!this.left&&this.right&&(t=this.right),!!t&&(this.parent?(this.parent.left===this?(this.parent.left=t,t.parent=this.parent):(this.parent.right=t,t.parent=this.parent),!0):(this.key=t.key,this.data=t.data,this.left=null,t.left&&(this.left=t.left,t.left.parent=this),this.right=null,t.right&&(this.right=t.right,t.right.parent=this),!0))},i.prototype.delete=function(t,e){var n,r=[],i=this;if(this.hasOwnProperty("key"))if(this.compareKeys(t,this.key)<0)this.left&&this.left.delete(t,e);else if(this.compareKeys(t,this.key)>0)this.right&&this.right.delete(t,e);else if(0!==!this.compareKeys(t,this.key))return this.data.length>1&&void 0!==e?(this.data.forEach((function(t){i.checkValueEquality(t,e)||r.push(t)})),void(i.data=r)):void(this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(Math.random()>=.5?(n=this.left.getMaxKeyDescendant(),this.key=n.key,this.data=n.data,this===n.parent?(this.left=n.left,n.left&&(n.left.parent=n.parent)):(n.parent.right=n.left,n.left&&(n.left.parent=n.parent))):(n=this.right.getMinKeyDescendant(),this.key=n.key,this.data=n.data,this===n.parent?(this.right=n.right,n.right&&(n.right.parent=n.parent)):(n.parent.left=n.right,n.right&&(n.right.parent=n.parent)))))},i.prototype.executeOnEveryNode=function(t){this.left&&this.left.executeOnEveryNode(t),t(this),this.right&&this.right.executeOnEveryNode(t)},i.prototype.prettyPrint=function(t,e){e=e||"",console.log(e+"* "+this.key),t&&console.log(e+"* "+this.data),(this.left||this.right)&&(this.left?this.left.prettyPrint(t,e+"  "):console.log(e+"  *"),this.right?this.right.prettyPrint(t,e+"  "):console.log(e+"  *"))},t.exports=i},function(t,e){t.exports.getRandomArray=function t(e){var n,r;return 0===e?[]:1===e?[0]:(n=t(e-1),r=Math.floor(Math.random()*e),n.splice(r,0,e-1),n)},t.exports.defaultCompareKeysFunction=function(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;var n=new Error("Couldn't compare elements");throw n.a=t,n.b=e,n},t.exports.defaultCheckValueEquality=function(t,e){return t===e}},function(t,e,n){var r=n(13);t.exports=r},function(t,e,n){"use strict";n.r(e),function(t){var e,r=n(0),i=n(11),o=n(3),a=n(1),u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}c((r=r.apply(t,e||[])).next())}))},s=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};function l(){var n=this;e=new r.BrowserWindow({width:720,height:600,webPreferences:{nodeIntegration:!0}});var l,f={},h=function(t,e){return c(n,void 0,void 0,(function(){var n;return s(this,(function(u){switch(u.label){case 0:return n=a.join(r.app.getAppPath(),"../",e),console.log("dbPathFile : "+n),o.existsSync(n)?console.log("db file exists."):(console.log("no DB file... ",n),o.writeFileSync(n,"")),f[t]=new i({filename:n,autoload:!1}),[4,f[t].loadDatabase()];case 1:return u.sent(),[2]}}))}))};h("habits","items.db"),h("order","order.db"),r.ipcMain.on("data_find",(function(t,e){var n;console.log("Main data_find"),f.order.find({}).exec((function(t,e){n=e[0].habitOrder})),l=n,f.habits.find({}).exec((function(e,r){if(console.log("db.habits.find()"),e)console.error("data_find - error");else if(0!==r.length){var i=n.map((function(t){for(var e=0;e<r.length;e++)if(r[e].habitKey==t)return r[e]}));t.sender.send("show_itemList",i,n)}else console.log("db no data")}))})),r.ipcMain.on("data_add",(function(t,e,n){console.log("db data_add()");var r={habitKey:e+1,habitName:"",habitDays:{monday:!1,tuesday:!1,wednesday:!1,thirsday:!1,friday:!1,sataday:!1,sunday:!1}};f.habits.insert(r,(function(t,e){})),console.log("habitOrder before update: ",n),n.splice(n.length,0,e+1),console.log("habitOrder after update: ",n),f.order.update({},{$set:{habitOrder:n}},{multi:!0},(function(t,e){})),l=n})),r.ipcMain.on("data_change_Name",(function(t,e){console.log("db data_change_Name()"),f.habits.update({habitKey:e.habitKey},{$set:{habitName:e.habitName}},{},(function(t,e){t&&console.log("err update: "+t)}))})),r.ipcMain.on("data_change_Day",(function(t,e){console.log("db data_change_Day()"),f.habits.update({habitKey:e.habitKey},{$set:{habitDays:e.habitDays}},{},(function(t,e){t&&console.log("err update: "+t)}))})),r.ipcMain.on("data_delete_Habit",(function(t,e){console.log("db data_delete_Habit()");c(n,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,f.habits.remove({habitKey:e.habitKey},{},(function(t,e){t&&console.log("err update: "+t)}))];case 1:return n.sent(),t=l,console.log("dbHabitOrder: ",l),t.splice(t.indexOf(e.habitKey),1),console.log("orderDb: ",t),f.order.update({},{$set:{habitOrder:t}},{multi:!0},(function(t,e){})),[2]}}))}))})),r.ipcMain.on("data_clear_AllDays",(function(t,e){console.log("db data_clear_AllDays()");f.habits.update({},{$set:{habitDays:{monday:!1,tuesday:!1,wednesday:!1,thirsday:!1,friday:!1,sataday:!1,sunday:!1}}},{multi:!0},(function(t,e){t&&console.log("err update: "+t)}))})),r.ipcMain.on("data_change_OneDaysAll",(function(t,e){console.log("db data_change_OneDaysAll()"),f.habits.find({}).exec((function(t,n){var r={};n.forEach((function(t){var n;r=Object.assign(t.habitDays,u(u({},t.habitDays),((n={})[e.className]=e.onOff,n))),console.log("habits.habitKey: "+t.habitKey),console.log(r),f.habits.update({habitKey:t.habitKey},{$set:{habitDays:r}},{},(function(t,e){t&&console.log("err update: "+t)}))}))}))})),r.ipcMain.on("data_reorder_habits",(function(t,e){console.log("db data_reorder_habits() - newOrder",e),f.order.update({},{$set:{habitOrder:e}},{multi:!0},(function(t,e){})),l=e})),e.webContents.on("new-window",(function(t,e){console.log("new-window"),t.preventDefault(),r.shell.openExternal(e)})),console.log("__dirname: "+t),e.loadFile(a.join(r.app.getAppPath(),"/view/index.html")),e.on("close",(function(){console.log(1),e.webContents.session.clearCache()})),e.webContents.openDevTools()}r.app.on("ready",l),r.app.on("window-all-closed",(function(){e=null,r.app.quit()})),r.app.on("activate",(function(){null===e&&l()}))}.call(this,"/")},function(t,e,n){var r=n(7),i=n(4),o=n(6),a=n(15),u=n(8),c=n(5),s=n(2),l=n(18),f=n(21);function h(t){var e;"string"==typeof t?(e=t,this.inMemoryOnly=!1):(e=(t=t||{}).filename,this.inMemoryOnly=t.inMemoryOnly||!1,this.autoload=t.autoload||!1,this.timestampData=t.timestampData||!1),e&&"string"==typeof e&&0!==e.length?this.filename=e:(this.filename=null,this.inMemoryOnly=!0),this.compareStrings=t.compareStrings,this.persistence=new l({db:this,nodeWebkitAppName:t.nodeWebkitAppName,afterSerialization:t.afterSerialization,beforeDeserialization:t.beforeDeserialization,corruptAlertThreshold:t.corruptAlertThreshold}),this.executor=new a,this.inMemoryOnly&&(this.executor.ready=!0),this.indexes={},this.indexes._id=new u({fieldName:"_id",unique:!0}),this.ttlIndexes={},this.autoload&&this.loadDatabase(t.onload||function(t){if(t)throw t})}c.inherits(h,n(22).EventEmitter),h.prototype.loadDatabase=function(){this.executor.push({this:this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)},h.prototype.getAllData=function(){return this.indexes._id.getAll()},h.prototype.resetIndexes=function(t){var e=this;Object.keys(this.indexes).forEach((function(n){e.indexes[n].reset(t)}))},h.prototype.ensureIndex=function(t,e){var n,r=e||function(){};if(!(t=t||{}).fieldName)return(n=new Error("Cannot create an index without a fieldName")).missingFieldName=!0,r(n);if(this.indexes[t.fieldName])return r(null);this.indexes[t.fieldName]=new u(t),void 0!==t.expireAfterSeconds&&(this.ttlIndexes[t.fieldName]=t.expireAfterSeconds);try{this.indexes[t.fieldName].insert(this.getAllData())}catch(e){return delete this.indexes[t.fieldName],r(e)}this.persistence.persistNewState([{$$indexCreated:t}],(function(t){return r(t||null)}))},h.prototype.removeIndex=function(t,e){var n=e||function(){};delete this.indexes[t],this.persistence.persistNewState([{$$indexRemoved:t}],(function(t){return n(t||null)}))},h.prototype.addToIndexes=function(t){var e,n,r,i=Object.keys(this.indexes);for(e=0;e<i.length;e+=1)try{this.indexes[i[e]].insert(t)}catch(t){n=e,r=t;break}if(r){for(e=0;e<n;e+=1)this.indexes[i[e]].remove(t);throw r}},h.prototype.removeFromIndexes=function(t){var e=this;Object.keys(this.indexes).forEach((function(n){e.indexes[n].remove(t)}))},h.prototype.updateIndexes=function(t,e){var n,r,i,o=Object.keys(this.indexes);for(n=0;n<o.length;n+=1)try{this.indexes[o[n]].update(t,e)}catch(t){r=n,i=t;break}if(i){for(n=0;n<r;n+=1)this.indexes[o[n]].revertUpdate(t,e);throw i}},h.prototype.getCandidates=function(t,e,n){var r,i=Object.keys(this.indexes),a=this;"function"==typeof e&&(n=e,e=!1),o.waterfall([function(e){return r=[],Object.keys(t).forEach((function(e){("string"==typeof t[e]||"number"==typeof t[e]||"boolean"==typeof t[e]||c.isDate(t[e])||null===t[e])&&r.push(e)})),(r=s.intersection(r,i)).length>0?e(null,a.indexes[r[0]].getMatching(t[r[0]])):(r=[],Object.keys(t).forEach((function(e){t[e]&&t[e].hasOwnProperty("$in")&&r.push(e)})),(r=s.intersection(r,i)).length>0?e(null,a.indexes[r[0]].getMatching(t[r[0]].$in)):(r=[],Object.keys(t).forEach((function(e){t[e]&&(t[e].hasOwnProperty("$lt")||t[e].hasOwnProperty("$lte")||t[e].hasOwnProperty("$gt")||t[e].hasOwnProperty("$gte"))&&r.push(e)})),(r=s.intersection(r,i)).length>0?e(null,a.indexes[r[0]].getBetweenBounds(t[r[0]])):e(null,a.getAllData())))},function(t){if(e)return n(null,t);var r=[],i=[],u=Object.keys(a.ttlIndexes);t.forEach((function(t){var e=!0;u.forEach((function(n){void 0!==t[n]&&c.isDate(t[n])&&Date.now()>t[n].getTime()+1e3*a.ttlIndexes[n]&&(e=!1)})),e?i.push(t):r.push(t._id)})),o.eachSeries(r,(function(t,e){a._remove({_id:t},{},(function(t){return t?n(t):e()}))}),(function(t){return n(null,i)}))}])},h.prototype._insert=function(t,e){var n,r=e||function(){};try{n=this.prepareDocumentForInsertion(t),this._insertInCache(n)}catch(t){return r(t)}this.persistence.persistNewState(c.isArray(n)?n:[n],(function(t){return t?r(t):r(null,i.deepCopy(n))}))},h.prototype.createNewId=function(){var t=r.uid(16);return this.indexes._id.getMatching(t).length>0&&(t=this.createNewId()),t},h.prototype.prepareDocumentForInsertion=function(t){var e,n=this;if(c.isArray(t))e=[],t.forEach((function(t){e.push(n.prepareDocumentForInsertion(t))}));else{void 0===(e=i.deepCopy(t))._id&&(e._id=this.createNewId());var r=new Date;this.timestampData&&void 0===e.createdAt&&(e.createdAt=r),this.timestampData&&void 0===e.updatedAt&&(e.updatedAt=r),i.checkObject(e)}return e},h.prototype._insertInCache=function(t){c.isArray(t)?this._insertMultipleDocsInCache(t):this.addToIndexes(t)},h.prototype._insertMultipleDocsInCache=function(t){var e,n,r;for(e=0;e<t.length;e+=1)try{this.addToIndexes(t[e])}catch(t){r=t,n=e;break}if(r){for(e=0;e<n;e+=1)this.removeFromIndexes(t[e]);throw r}},h.prototype.insert=function(){this.executor.push({this:this,fn:this._insert,arguments:arguments})},h.prototype.count=function(t,e){var n=new f(this,t,(function(t,e,n){return t?n(t):n(null,e.length)}));if("function"!=typeof e)return n;n.exec(e)},h.prototype.find=function(t,e,n){switch(arguments.length){case 1:e={};break;case 2:"function"==typeof e&&(n=e,e={})}var r=new f(this,t,(function(t,e,n){var r,o=[];if(t)return n(t);for(r=0;r<e.length;r+=1)o.push(i.deepCopy(e[r]));return n(null,o)}));if(r.projection(e),"function"!=typeof n)return r;r.exec(n)},h.prototype.findOne=function(t,e,n){switch(arguments.length){case 1:e={};break;case 2:"function"==typeof e&&(n=e,e={})}var r=new f(this,t,(function(t,e,n){return t?n(t):1===e.length?n(null,i.deepCopy(e[0])):n(null,null)}));if(r.projection(e).limit(1),"function"!=typeof n)return r;r.exec(n)},h.prototype._update=function(t,e,n,r){var a,u,c,l,h=this,p=0;"function"==typeof n&&(r=n,n={}),a=r||function(){},u=void 0!==n.multi&&n.multi,c=void 0!==n.upsert&&n.upsert,o.waterfall([function(n){if(!c)return n();new f(h,t).limit(1)._exec((function(r,o){if(r)return a(r);if(1===o.length)return n();var u;try{i.checkObject(e),u=e}catch(n){try{u=i.modify(i.deepCopy(t,!0),e)}catch(r){return a(r)}}return h._insert(u,(function(t,e){return t?a(t):a(null,1,e,!0)}))}))},function(){var r,o,c=[];h.getCandidates(t,(function(f,d){if(f)return a(f);try{for(l=0;l<d.length;l+=1)i.match(d[l],t)&&(u||0===p)&&(p+=1,h.timestampData&&(o=d[l].createdAt),r=i.modify(d[l],e),h.timestampData&&(r.createdAt=o,r.updatedAt=new Date),c.push({oldDoc:d[l],newDoc:r}))}catch(f){return a(f)}try{h.updateIndexes(c)}catch(f){return a(f)}var y=s.pluck(c,"newDoc");h.persistence.persistNewState(y,(function(t){if(t)return a(t);if(n.returnUpdatedDocs){var e=[];return y.forEach((function(t){e.push(i.deepCopy(t))})),u||(e=e[0]),a(null,p,e)}return a(null,p)}))}))}])},h.prototype.update=function(){this.executor.push({this:this,fn:this._update,arguments:arguments})},h.prototype._remove=function(t,e,n){var r,o,a=this,u=0,c=[];"function"==typeof e&&(n=e,e={}),r=n||function(){},o=void 0!==e.multi&&e.multi,this.getCandidates(t,!0,(function(e,n){if(e)return r(e);try{n.forEach((function(e){i.match(e,t)&&(o||0===u)&&(u+=1,c.push({$$deleted:!0,_id:e._id}),a.removeFromIndexes(e))}))}catch(e){return r(e)}a.persistence.persistNewState(c,(function(t){return t?r(t):r(null,u)}))}))},h.prototype.remove=function(){this.executor.push({this:this,fn:this._remove,arguments:arguments})},t.exports=h},function(t,e){t.exports=require("crypto")},function(t,e,n){var r=n(6);function i(){this.buffer=[],this.ready=!1,this.queue=r.queue((function(t,e){for(var n=[],r=0;r<t.arguments.length;r+=1)n.push(t.arguments[r]);var i=t.arguments[t.arguments.length-1];"function"==typeof i?n[n.length-1]=function(){"function"==typeof setImmediate?setImmediate(e):process.nextTick(e),i.apply(null,arguments)}:i||0===t.arguments.length?n.push((function(){e()})):n[n.length-1]=function(){e()},t.fn.apply(t.this,n)}),1)}i.prototype.push=function(t,e){this.ready||e?this.queue.push(t):this.buffer.push(t)},i.prototype.processBuffer=function(){var t;for(this.ready=!0,t=0;t<this.buffer.length;t+=1)this.queue.push(this.buffer[t]);this.buffer=[]},t.exports=i},function(t,e,n){t.exports.BinarySearchTree=n(9),t.exports.AVLTree=n(17)},function(t,e,n){var r=n(9),i=n(10),o=n(5);n(2);function a(t){this.tree=new u(t)}function u(t){t=t||{},this.left=null,this.right=null,this.parent=void 0!==t.parent?t.parent:null,t.hasOwnProperty("key")&&(this.key=t.key),this.data=t.hasOwnProperty("value")?[t.value]:[],this.unique=t.unique||!1,this.compareKeys=t.compareKeys||i.defaultCompareKeysFunction,this.checkValueEquality=t.checkValueEquality||i.defaultCheckValueEquality}o.inherits(u,r),a._AVLTree=u,u.prototype.checkHeightCorrect=function(){var t,e;if(this.hasOwnProperty("key")){if(this.left&&void 0===this.left.height)throw new Error("Undefined height for node "+this.left.key);if(this.right&&void 0===this.right.height)throw new Error("Undefined height for node "+this.right.key);if(void 0===this.height)throw new Error("Undefined height for node "+this.key);if(t=this.left?this.left.height:0,e=this.right?this.right.height:0,this.height!==1+Math.max(t,e))throw new Error("Height constraint failed for node "+this.key);this.left&&this.left.checkHeightCorrect(),this.right&&this.right.checkHeightCorrect()}},u.prototype.balanceFactor=function(){return(this.left?this.left.height:0)-(this.right?this.right.height:0)},u.prototype.checkBalanceFactors=function(){if(Math.abs(this.balanceFactor())>1)throw new Error("Tree is unbalanced at node "+this.key);this.left&&this.left.checkBalanceFactors(),this.right&&this.right.checkBalanceFactors()},u.prototype.checkIsAVLT=function(){u.super_.prototype.checkIsBST.call(this),this.checkHeightCorrect(),this.checkBalanceFactors()},a.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()},u.prototype.rightRotation=function(){var t,e,n,r,i=this,o=this.left;return o?(t=o.right,i.parent?(o.parent=i.parent,i.parent.left===i?i.parent.left=o:i.parent.right=o):o.parent=null,o.right=i,i.parent=o,i.left=t,t&&(t.parent=i),e=o.left?o.left.height:0,n=t?t.height:0,r=i.right?i.right.height:0,i.height=Math.max(n,r)+1,o.height=Math.max(e,i.height)+1,o):this},u.prototype.leftRotation=function(){var t,e,n,r,i=this,o=this.right;return o?(t=o.left,i.parent?(o.parent=i.parent,i.parent.left===i?i.parent.left=o:i.parent.right=o):o.parent=null,o.left=i,i.parent=o,i.right=t,t&&(t.parent=i),e=i.left?i.left.height:0,n=t?t.height:0,r=o.right?o.right.height:0,i.height=Math.max(e,n)+1,o.height=Math.max(r,i.height)+1,o):this},u.prototype.rightTooSmall=function(){return this.balanceFactor()<=1?this:(this.left.balanceFactor()<0&&this.left.leftRotation(),this.rightRotation())},u.prototype.leftTooSmall=function(){return this.balanceFactor()>=-1?this:(this.right.balanceFactor()>0&&this.right.rightRotation(),this.leftRotation())},u.prototype.rebalanceAlongPath=function(t){var e,n,r=this;if(!this.hasOwnProperty("key"))return delete this.height,this;for(n=t.length-1;n>=0;n-=1)t[n].height=1+Math.max(t[n].left?t[n].left.height:0,t[n].right?t[n].right.height:0),t[n].balanceFactor()>1&&(e=t[n].rightTooSmall(),0===n&&(r=e)),t[n].balanceFactor()<-1&&(e=t[n].leftTooSmall(),0===n&&(r=e));return r},u.prototype.insert=function(t,e){var n=[],r=this;if(!this.hasOwnProperty("key"))return this.key=t,this.data.push(e),this.height=1,this;for(;;){if(0===r.compareKeys(r.key,t)){if(r.unique){var i=new Error("Can't insert key "+t+", it violates the unique constraint");throw i.key=t,i.errorType="uniqueViolated",i}return r.data.push(e),this}if(n.push(r),r.compareKeys(t,r.key)<0){if(!r.left){n.push(r.createLeftChild({key:t,value:e}));break}r=r.left}else{if(!r.right){n.push(r.createRightChild({key:t,value:e}));break}r=r.right}}return this.rebalanceAlongPath(n)},a.prototype.insert=function(t,e){var n=this.tree.insert(t,e);n&&(this.tree=n)},u.prototype.delete=function(t,e){var n,r=[],i=this,o=[];if(!this.hasOwnProperty("key"))return this;for(;0!==i.compareKeys(t,i.key);)if(o.push(i),i.compareKeys(t,i.key)<0){if(!i.left)return this;i=i.left}else{if(!i.right)return this;i=i.right}if(i.data.length>1&&e)return i.data.forEach((function(t){i.checkValueEquality(t,e)||r.push(t)})),i.data=r,this;if(!i.left&&!i.right)return i===this?(delete i.key,i.data=[],delete i.height,this):(i.parent.left===i?i.parent.left=null:i.parent.right=null,this.rebalanceAlongPath(o));if(!i.left||!i.right)return n=i.left?i.left:i.right,i===this?(n.parent=null,n):(i.parent.left===i?(i.parent.left=n,n.parent=i.parent):(i.parent.right=n,n.parent=i.parent),this.rebalanceAlongPath(o));if(o.push(i),!(n=i.left).right)return i.key=n.key,i.data=n.data,i.left=n.left,n.left&&(n.left.parent=i),this.rebalanceAlongPath(o);for(;n.right;)o.push(n),n=n.right;return i.key=n.key,i.data=n.data,n.parent.right=n.left,n.left&&(n.left.parent=n.parent),this.rebalanceAlongPath(o)},a.prototype.delete=function(t,e){var n=this.tree.delete(t,e);n&&(this.tree=n)},["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach((function(t){a.prototype[t]=function(){return this.tree[t].apply(this.tree,arguments)}})),t.exports=a},function(t,e,n){var r=n(19),i=n(1),o=n(4),a=n(6),u=n(7),c=n(8);function s(t){var e,n,r;if(this.db=t.db,this.inMemoryOnly=this.db.inMemoryOnly,this.filename=this.db.filename,this.corruptAlertThreshold=void 0!==t.corruptAlertThreshold?t.corruptAlertThreshold:.1,!this.inMemoryOnly&&this.filename&&"~"===this.filename.charAt(this.filename.length-1))throw new Error("The datafile name can't end with a ~, which is reserved for crash safe backup files");if(t.afterSerialization&&!t.beforeDeserialization)throw new Error("Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss");if(!t.afterSerialization&&t.beforeDeserialization)throw new Error("Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss");for(this.afterSerialization=t.afterSerialization||function(t){return t},this.beforeDeserialization=t.beforeDeserialization||function(t){return t},e=1;e<30;e+=1)for(n=0;n<10;n+=1)if(r=u.uid(e),this.beforeDeserialization(this.afterSerialization(r))!==r)throw new Error("beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss");this.filename&&t.nodeWebkitAppName&&(console.log("=================================================================="),console.log("WARNING: The nodeWebkitAppName option is deprecated"),console.log("To get the path to the directory where Node Webkit stores the data"),console.log("for your app, use the internal nw.gui module like this"),console.log("require('nw.gui').App.dataPath"),console.log("See https://github.com/rogerwang/node-webkit/issues/500"),console.log("=================================================================="),this.filename=s.getNWAppFilename(t.nodeWebkitAppName,this.filename))}s.ensureDirectoryExists=function(t,e){var n=e||function(){};r.mkdirp(t,(function(t){return n(t)}))},s.getNWAppFilename=function(t,e){var n;switch(process.platform){case"win32":case"win64":if(!(n=process.env.LOCALAPPDATA||process.env.APPDATA))throw new Error("Couldn't find the base application data folder");n=i.join(n,t);break;case"darwin":if(!(n=process.env.HOME))throw new Error("Couldn't find the base application data directory");n=i.join(n,"Library","Application Support",t);break;case"linux":if(!(n=process.env.HOME))throw new Error("Couldn't find the base application data directory");n=i.join(n,".config",t);break;default:throw new Error("Can't use the Node Webkit relative path for platform "+process.platform)}return i.join(n,"nedb-data",e)},s.prototype.persistCachedDatabase=function(t){var e=t||function(){},n="",i=this;if(this.inMemoryOnly)return e(null);this.db.getAllData().forEach((function(t){n+=i.afterSerialization(o.serialize(t))+"\n"})),Object.keys(this.db.indexes).forEach((function(t){"_id"!=t&&(n+=i.afterSerialization(o.serialize({$$indexCreated:{fieldName:t,unique:i.db.indexes[t].unique,sparse:i.db.indexes[t].sparse}}))+"\n")})),r.crashSafeWriteFile(this.filename,n,(function(t){return t?e(t):(i.db.emit("compaction.done"),e(null))}))},s.prototype.compactDatafile=function(){this.db.executor.push({this:this,fn:this.persistCachedDatabase,arguments:[]})},s.prototype.setAutocompactionInterval=function(t){var e=this,n=Math.max(t||0,5e3);this.stopAutocompaction(),this.autocompactionIntervalId=setInterval((function(){e.compactDatafile()}),n)},s.prototype.stopAutocompaction=function(){this.autocompactionIntervalId&&clearInterval(this.autocompactionIntervalId)},s.prototype.persistNewState=function(t,e){var n=this,i="",a=e||function(){};return n.inMemoryOnly?a(null):(t.forEach((function(t){i+=n.afterSerialization(o.serialize(t))+"\n"})),0===i.length?a(null):void r.appendFile(n.filename,i,"utf8",(function(t){return a(t)})))},s.prototype.treatRawData=function(t){var e,n=t.split("\n"),r={},i=[],a={},u=-1;for(e=0;e<n.length;e+=1){var c;try{(c=o.deserialize(this.beforeDeserialization(n[e])))._id?!0===c.$$deleted?delete r[c._id]:r[c._id]=c:c.$$indexCreated&&null!=c.$$indexCreated.fieldName?a[c.$$indexCreated.fieldName]=c.$$indexCreated:"string"==typeof c.$$indexRemoved&&delete a[c.$$indexRemoved]}catch(t){u+=1}}if(n.length>0&&u/n.length>this.corruptAlertThreshold)throw new Error("More than "+Math.floor(100*this.corruptAlertThreshold)+"% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss");return Object.keys(r).forEach((function(t){i.push(r[t])})),{data:i,indexes:a}},s.prototype.loadDatabase=function(t){var e=t||function(){},n=this;if(n.db.resetIndexes(),n.inMemoryOnly)return e(null);a.waterfall([function(t){s.ensureDirectoryExists(i.dirname(n.filename),(function(e){r.ensureDatafileIntegrity(n.filename,(function(e){r.readFile(n.filename,"utf8",(function(e,r){if(e)return t(e);try{var i=n.treatRawData(r)}catch(e){return t(e)}Object.keys(i.indexes).forEach((function(t){n.db.indexes[t]=new c(i.indexes[t])}));try{n.db.resetIndexes(i.data)}catch(e){return n.db.resetIndexes(),t(e)}n.db.persistence.persistCachedDatabase(t)}))}))}))}],(function(t){return t?e(t):(n.db.executor.processBuffer(),e(null))}))},t.exports=s},function(t,e,n){var r=n(3),i=n(20),o=n(6),a=n(1),u={};u.exists=r.exists,u.rename=r.rename,u.writeFile=r.writeFile,u.unlink=r.unlink,u.appendFile=r.appendFile,u.readFile=r.readFile,u.mkdirp=i,u.ensureFileDoesntExist=function(t,e){u.exists(t,(function(n){if(!n)return e(null);u.unlink(t,(function(t){return e(t)}))}))},u.flushToStorage=function(t,e){var n,i;if("string"==typeof t?(n=t,i="r+"):(n=t.filename,i=t.isDir?"r":"r+"),"r"===i&&("win32"===process.platform||"win64"===process.platform))return e(null);r.open(n,i,(function(t,n){if(t)return e(t);r.fsync(n,(function(t){r.close(n,(function(n){if(t||n){var r=new Error("Failed to flush to storage");return r.errorOnFsync=t,r.errorOnClose=n,e(r)}return e(null)}))}))}))},u.crashSafeWriteFile=function(t,e,n){var r=n||function(){},i=t+"~";o.waterfall([o.apply(u.flushToStorage,{filename:a.dirname(t),isDir:!0}),function(e){u.exists(t,(function(n){if(!n)return e();u.flushToStorage(t,(function(t){return e(t)}))}))},function(t){u.writeFile(i,e,(function(e){return t(e)}))},o.apply(u.flushToStorage,i),function(e){u.rename(i,t,(function(t){return e(t)}))},o.apply(u.flushToStorage,{filename:a.dirname(t),isDir:!0})],(function(t){return r(t)}))},u.ensureDatafileIntegrity=function(t,e){var n=t+"~";u.exists(t,(function(r){if(r)return e(null);u.exists(n,(function(r){if(!r)return u.writeFile(t,"","utf8",(function(t){e(t)}));u.rename(n,t,(function(t){return e(t)}))}))}))},t.exports=u},function(t,e,n){var r=n(1),i=n(3),o=parseInt("0777",8);function a(t,e,n,u){"function"==typeof e?(n=e,e={}):e&&"object"==typeof e||(e={mode:e});var c=e.mode,s=e.fs||i;void 0===c&&(c=o),u||(u=null);var l=n||function(){};t=r.resolve(t),s.mkdir(t,c,(function(n){if(!n)return l(null,u=u||t);switch(n.code){case"ENOENT":if(r.dirname(t)===t)return l(n);a(r.dirname(t),e,(function(n,r){n?l(n,r):a(t,e,l,r)}));break;default:s.stat(t,(function(t,e){t||!e.isDirectory()?l(n,u):l(null,u)}))}}))}t.exports=a.mkdirp=a.mkdirP=a,a.sync=function t(e,n,a){n&&"object"==typeof n||(n={mode:n});var u=n.mode,c=n.fs||i;void 0===u&&(u=o),a||(a=null),e=r.resolve(e);try{c.mkdirSync(e,u),a=a||e}catch(i){switch(i.code){case"ENOENT":a=t(r.dirname(e),n,a),t(e,n,a);break;default:var s;try{s=c.statSync(e)}catch(t){throw i}if(!s.isDirectory())throw i}}return a}},function(t,e,n){var r=n(4),i=n(2);function o(t,e,n){this.db=t,this.query=e||{},n&&(this.execFn=n)}o.prototype.limit=function(t){return this._limit=t,this},o.prototype.skip=function(t){return this._skip=t,this},o.prototype.sort=function(t){return this._sort=t,this},o.prototype.projection=function(t){return this._projection=t,this},o.prototype.project=function(t){var e,n,o,a=[],u=this;return void 0===this._projection||0===Object.keys(this._projection).length?t:(e=0!==this._projection._id,this._projection=i.omit(this._projection,"_id"),(o=Object.keys(this._projection)).forEach((function(t){if(void 0!==n&&u._projection[t]!==n)throw new Error("Can't both keep and omit fields except for _id");n=u._projection[t]})),t.forEach((function(t){var i;1===n?(i={$set:{}},o.forEach((function(e){i.$set[e]=r.getDotValue(t,e),void 0===i.$set[e]&&delete i.$set[e]})),i=r.modify({},i)):(i={$unset:{}},o.forEach((function(t){i.$unset[t]=!0})),i=r.modify(t,i)),e?i._id=t._id:delete i._id,a.push(i)})),a)},o.prototype._exec=function(t){var e,n,i,o=[],a=0,u=0,c=this,s=null;function l(e,n){return c.execFn?c.execFn(e,n,t):t(e,n)}this.db.getCandidates(this.query,(function(t,f){if(t)return l(t);try{for(e=0;e<f.length;e+=1)if(r.match(f[e],c.query))if(c._sort)o.push(f[e]);else if(c._skip&&c._skip>u)u+=1;else if(o.push(f[e]),a+=1,c._limit&&c._limit<=a)break}catch(t){return l(t)}if(c._sort){n=Object.keys(c._sort);var h=[];for(e=0;e<n.length;e++)i=n[e],h.push({key:i,direction:c._sort[i]});o.sort((function(t,e){var n,i,o;for(o=0;o<h.length;o++)if(0!==(i=(n=h[o]).direction*r.compareThings(r.getDotValue(t,n.key),r.getDotValue(e,n.key),c.db.compareStrings)))return i;return 0}));var p=c._limit||o.length,d=c._skip||0;o=o.slice(d,d+p)}try{o=c.project(o)}catch(t){s=t,o=void 0}return l(s,o)}))},o.prototype.exec=function(){this.db.executor.push({this:this,fn:this._exec,arguments:arguments})},t.exports=o},function(t,e){t.exports=require("events")}]);